Superset предлагает несколько мощных способов для визуализации и анализа иерархических данных. Вот основные подходы и подходящие типы чартов:

### 1. Sunburst Chart (Диаграмма "Солнечные лучи") — Лучший для визуализации

Идеально подходит для отображения пропорций и вложенности внутри иерархии.

**Как настроить:**
- **Внутренний круг (Hierarchy):** Добавьте поля иерархии в секцию `Hierarchy` (например: `Регион -> Город -> Магазин`).
- **Внешний круг (Metric):** В секцию `Primary Metric` добавьте агрегированную меру (например: `SUM(Продажи)`).
- **Включите опцию** `Show Total` для отображения общего итога.

**Преимущества:**
- Наглядно показывает вложенность и пропорции каждого уровня.
- Поддерживает drill-down (возможность кликнуть на сегмент для детализации).

---

### 2. Treemap Chart (Древовидная карта) — Альтернатива Sunburst

Также отлично подходит для отображения иерархии через вложенные прямоугольники.

**Как настроить:**
- **Вложенность:** Используйте секцию `TreeMap` для указания иерархии (например: `[Категория, Подкатегория, Товар]`).
- **Размер прямоугольника:** Укажите метрику в `Metric` (например: `SUM(Продажи)`).
- **Цвет:** Можете использовать другую метрику для окрашивания элементов.

**Плюсы:**
- Эффективно использует пространство для отображения больших объемов данных.
- Позволяет быстро сравнивать размеры элементов на одном уровне.

---

### 3. Pivot Table (Сводная таблица) — Для детального анализа с итогами

Это самый мощный инструмент для работы с иерархическими данными, если нужны точные цифры и группировки.

**Как настроить:**
- **Строки (Rows):** Добавьте несколько полей для создания иерархии (например: `Континент`, `Страна`, `Город`). Supastic будет автоматически группировать и подводить промежуточные итоги.
- **Столбцы (Columns):** Можно добавить временные периоды или категории для перекрестного анализа.
- **Метрики (Metrics):** Добавьте необходимые агрегированные показатели (`SUM`, `COUNT`, `AVG`).
- **Включите опции:**
  - `Show Totals` для отображения общих итогов.
  - `Transpose Pivot` для переворота таблицы.
  - `Combine Metrics` для объединения метрик.

**Ключевые возможности:**
- Автоматическое вычисление **промежуточных итогов** для каждого уровня группировки.
- Возможность **"схлопывать" и "разворачивать"** уровни группировки прямо в таблице (обычно кликом по значку `+`/`-`).
- Сортировка по любому из уровней или метрик.

---

### 4. Дополнительные варианты

- **Time-series Table:** Если ваша иерархия включает время, эта таблица позволяет удобно агрегировать данные по разным временным интервалам (год, квартал, месяц) с подведением итогов.
- **Hierarchical Bar Chart:** Некоторые плагины или кастомные визуализации предлагают барчарты с возможностью drill-down по уровням иерархии.

### Best Practices для настройки:

1.  **Подготовьте данные:** Идеально, если ваша иерархия уже представлена в виде отдельных колонок в БД (`Уровень1`, `Уровень2`, `Уровень3`). Если нет — можно использовать SQL-запрос в датасете для их создания.
2.  **Используйте правильный порядок:** При настройке всегда добавляйте поля в правильном порядке — от высшего уровня к низшему (например, в Pivot Table: `Континент` -> `Страна` -> `Город`).
3.  **Настройте агрегацию:** Убедитесь, что для всех метрик выбраны правильные агрегирующие функции (`SUM`, `COUNT`), чтобы итоги считались корректно.
4.  **Комбинируйте чарты:** Создайте дашборд, где:
    - **Sunburst/Treemap** будет давать общее визуальное представление о структуре и пропорциях.
    - **Pivot Table** будет предоставлять точные цифры, промежуточные итоги и возможность детализации.

Пример дашборда может выглядеть так: наверху `Sunburst` с иерархией `Регион -> Город`, а ниже `Pivot Table` с детальными данными, где можно развернуть любой регион и посмотреть вклад каждого города.

Таким образом, **Pivot Table** — ваш главный инструмент для работы с цифрами и итогами, а **Sunburst**/ **Treemap** — для быстрой визуальной оценки.
