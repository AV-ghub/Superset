### 1. Heatmap (Тепловая карта)

**Что это такое?**
Это таблица, где **ячейки окрашены в разные цвета** в зависимости от числового значения в них. Чем интенсивнее цвет (например, темнее красный или зеленый), тем больше значение.

**Какую задачу решает?**
Быстро найти **"горячие" точки** (аномалии, пики, провалы) в таблице с большим количеством чисел, где просто смотреть на цифры неэффективно.

**Простой пример:**
Допустим, у вас есть таблица продаж по дням недели и продуктам.

| Продукт / День | Пн | Вт | Ср | Чт | Пт |
| :--- | :--- | :--- | :--- | :--- | :--- |
| Футболка | 10 | 15 | **50** | 12 | 18 |
| Кружка | 5 | 10 | 7 | 12 | **20** |
| Носки | **25** | 10 | 5 | 8 | 15 |

Глазу тяжело найти максимумы. Heatmap окрасит ячейку с 50 ($\text{Футболка, Ср}$) в интенсивный красный, с 25 ($\text{Носки, Пн}$) в менее интенсивный красный, а с 5 ($\text{Носки, Ср}$) — в зеленый (если использовать красно-зеленую палитру).

**Как настроить в Superset:**
1.  **Rows (Строки):** Столбец для группировки по строкам (например, `product_name`).
2.  **Columns (Столбцы):** Столбец для группировки по столбцам (например, `day_of_week`).
3.  **Metric (Метрика):** Числовой показатель, который будет отображаться цветом (например, `SUM(sales)`).
4.  **Normalize by (Нормализация):** *Опционально.* Очень мощная функция. Позволяет показывать не абсолютные значения, а **доли**.
    *   **"Row"**: Значение в каждой ячейке будет показано как процент от итога своей *строки*. Покажет, *в какой день недели каждый товар продавался лучше всего*.
    *   **"Column"**: Значение в каждой ячейке будет показано как процент от итога своего *столбца*. Покажет, *какой товар был самым популярным в каждый конкретный день*.
    *   **"All"**: Значение в каждой ячейке будет показано как процент от *общего итога*.

---

### 2. Cohort Chart (Кохортный анализ)

**Что это такое?**
Это специальный тип тепловой карты, который показывает, **как со временем изменяется поведение группы пользователей (кохорты)**, объединенных общим признаком (например, датой первой покупки).

**Какую задачу решает?**
Ответить на вопросы типа: **"Как много пользователей, которые пришли в январе, вернулись и сделали покупку в феврале, марте и т.д.?"** Это классический инструмент для анализа **оттока (churn)** и **удержания (retention)**.

**Ключевые понятия:**
*   **Кохорта** — группа пользователей, объединенных по действию в определенный период времени (например, "пользователи, зарегистрировавшиеся в январе").
*   **Период** — единица времени для анализа (день, неделя, месяц).
*   **Удержание (Retention)** — процент пользователей из кохорты, которые совершили целевое действие в последующие периоды.

**Простой пример:**
Допустим, мы анализируем удержание пользователей по месяцам.

| Кохорта \ Месяц | Месяц 0 | Месяц 1 | Месяц 2 | Месяц 3 |
| :--- | :--- | :--- | :--- | :--- |
| **Январь** | 100% (100 чел.) | **65%** | 40% | 25% |
| **Февраль** | 100% (120 чел.) | **70%** | 45% | ... |
| **Март** | 100% (110 чел.) | **80%** | ... | ... |

*   **Кохорта "Январь":** 100 человек совершили первую покупку в январе (Месяц 0). В феврале (Месяц 1) 65 из них совершили еще хотя бы одну покупку (удержание 65%). В марте (Месяц 2) — 40 человек, и т.д.
*   **Вывод:** Мы видим, что кохорта "Март" имеет лучшее удержание на первом месяце (80%), чем "Январь" (65%).

**Как настроить в Superset:**
Настройка сложнее, и данные должны быть специально подготовлены.
1.  **Time Period (Период):** Столбец с датой/временем действия пользователя (например, `order_date`).
2.  **Cohort (Кохорта):** Столбец, по которому группируются кохорты. Чаще всего это то же самое, что и `Time Period`, но с другой агрегацией (например, `MIN(order_date)` для нахождения даты первой покупки пользователя).
3.  **Metric (Метрика):** Обычно это `COUNT(DISTINCT user_id)`, чтобы подсчитать уникальных пользователей.
4.  **Cohort Period Type:** Выбрать granularity (неделя, месяц, квартал и т.д.).

### Итог: Сравнение

| Признак | Heatmap | Cohort Chart |
| :--- | :--- | :--- |
| **Цель** | Найти паттерны и аномалии в **перекрестной таблице** | Проанализировать **поведение групп во времени** |
| **Данные** | Любые данные, которые можно свести в таблицу | Данные с временными метками о действиях пользователей |
| **Пример** | Продажи товаров по дням недели | Удержание пользователей по месяцам после регистрации |

**Heatmap** — это в первую очередь **инструмент визуализации** для любой таблицы.
**Cohort Chart** — это **готовый аналитический метод** для строго определенной бизнес-задачи (анализ удержания).

Начните с построения простого Heatmap — это даст вам понимание логики. Cohort Chart требует более глубокой подготовки данных и постановки задачи.
